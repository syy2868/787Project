// This file is generated by FBC.

#include "Gate.h"
#include <string.h>
#include <stdio.h>

/* Function block initialization function */
void Gateinit(Gate* me)
{
    me->_state = 0;
    me->_entered = false;
    me->_input.events = 0;
    me->_output.events = 0;
}

/* ECC algorithms */
void Gate_opening(Gate* me)
{
me->x = me->C1x*exp(-1.0L/2.0L*me->d*me->k) + 1;
if(me->x>1){
printf("Gate is opening : %f\n", me->x);
}else{
printf("Gate is open: %f\n", me->x);  
}
(me->k)++;
}

void Gate_closing(Gate* me)
{
me->x = me->C1x*exp(-1.0L/2.0L*me->d*me->k)+10;
if(me->x<10){
printf("Gate is closing : %f\n", me->x);
}else{
printf("Gate is closed: %f\n", me->x);  
}
(me->k)++;
}

void Gate_init(Gate* me)
{
me->x=10;
me->k=0;
me->d=0.1;
me->C1x=0;
}

void Gate_initial_condition10(Gate* me)
{
me->k=0;
me->C1x=me->x-10;
printf("Gate starts to raise\n");
}

void Gate_initial_condition1(Gate* me)
{
me->k=0;
me->C1x=me->x-1;
printf("Gate starts to lower\n");
}

/* Function block execution function */
void Gaterun(Gate* me)
{
    me->_output.events = 0;

    for (;;) {
        switch (me->_state) {
            case 0:
                // State: Start
                if (!me->_entered) {
                    Gate_init(me);
                    me->_output.event.update_g = 1;
                    me->_entered = true;
                }
                else {
                    me->_state = 1;
                    me->_entered = false;
                    continue;
                }
                break;
            case 1:
                // State: State1
                if (!me->_entered) {
                    Gate_closing(me);
                    me->_output.event.update_g = 1;
                    me->_entered = true;
                }
                else {
                    if (me->_input.event.DOWN) {
                        me->_state = 2;
                        me->_entered = false;
                        continue;
                    }
                    else {
                        me->_state = 1;
                        me->_entered = false;
                        continue;
                    }
                }
                break;
            case 2:
                // State: State3
                if (!me->_entered) {
                    Gate_initial_condition1(me);
                    me->_output.event.update_g = 1;
                    me->_entered = true;
                }
                else {
                    me->_state = 3;
                    me->_entered = false;
                    continue;
                }
                break;
            case 3:
                // State: State2
                if (!me->_entered) {
                    Gate_opening(me);
                    me->_output.event.update_g = 1;
                    me->_entered = true;
                }
                else {
                    if (me->_input.event.UP) {
                        me->_state = 4;
                        me->_entered = false;
                        continue;
                    }
                    else {
                        me->_state = 3;
                        me->_entered = false;
                        continue;
                    }
                }
                break;
            case 4:
                // State: State4
                if (!me->_entered) {
                    Gate_initial_condition10(me);
                    me->_output.event.update_g = 1;
                    me->_entered = true;
                }
                else {
                    me->_state = 1;
                    me->_entered = false;
                    continue;
                }
                break;
        }
        break;
    }
    if (me->_output.event.update_g) {
        me->_x = me->x;
    }

    me->_input.events = 0;
}

